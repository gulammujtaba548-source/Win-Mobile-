<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Admin - Muhammad Sarfraz Control</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 15px; text-align: center; }
        .header { background: #ff6b6b; color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn { padding: 12px 18px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 5px; color: white; transition: 0.3s; }
        .btn:active { transform: scale(0.95); }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; margin-top: 20px; font-size: 14px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #333; color: white; }
        .approve-btn { background: #22c55e; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0;">Admin Control (NayaPay Only)</h2>
        <p style="margin:5px 0;">Account Holder: <b>Muhammad Sarfraz</b></p>
        <hr style="border: 0.5px solid rgba(255,255,255,0.3); margin: 15px 0;">
        
        <button class="btn" style="background: #ffc107; color: black;" onclick="pickWinner()">üéÅ PICK WINNER</button>
        <button class="btn" style="background: #e67e22;" onclick="resetWinner()">üîÑ RESET RECENT WINNER</button>
        <button class="btn" style="background: #34495e;" onclick="clearAll()">üóëÔ∏è RESET ALL PARTICIPANTS</button>
    </div>

    <table>
        <thead>
            <tr><th>Name</th><th>Phone</th><th>TID</th><th>Action</th></tr>
        </thead>
        <tbody id="list"></tbody>
    </table>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBbV_Z_VxGN39qdR1AMngqdX0UYGANdcMM",
            authDomain: "dollar-game-de93b.firebaseapp.com",
            projectId: "dollar-game-de93b",
            storageBucket: "dollar-game-de93b.firebasestorage.app",
            messagingSenderId: "633246448026",
            appId: "1:633246448026:web:eeea8692c832a3ca682223"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Listen for entries
        db.collection("dollar_entries").orderBy("timestamp", "desc").onSnapshot(snap => {
            const tbody = document.getElementById("list");
            tbody.innerHTML = ""; 
            snap.forEach(doc => {
                const d = doc.data();
                const btn = d.status === "Pending" ? `<button class="approve-btn" onclick="approve('${doc.id}')">Approve</button>` : "‚úÖ Approved";
                tbody.innerHTML += `<tr><td>${d.name}</td><td>${d.phone}</td><td>${d.transactionId}</td><td>${btn}</td></tr>`;
            });
        });

        async function approve(id) { 
            await db.collection("dollar_entries").doc(id).update({status: "Approved"}); 
        }

        async function pickWinner() {
            const snap = await db.collection("dollar_entries").get();
            const entries = [];
            snap.forEach(doc => entries.push(doc.data()));
            if (entries.length === 0) return alert("No entries found!");
            const win = entries[Math.floor(Math.random() * entries.length)];
            await db.collection("winners").doc("latest").set({
                name: win.name, 
                date: new Date().toLocaleDateString()
            });
            alert("Winner Selected: " + win.name);
        }

        // Function to reset winner display
        async function resetWinner() {
            if(confirm("Website se winner ka naam hata dein?")) {
                await db.collection("winners").doc("latest").delete();
                alert("Winner display reset successfully!");
            }
        }

        async function clearAll() {
            if(confirm("Sari entries delete kar dein? Yeh amal wapis nahi ho sakta.")) {
                const snap = await db.collection("dollar_entries").get();
                const batch = db.batch();
                snap.forEach(doc => batch.delete(doc.ref));
                await batch.commit();
                alert("All participants data cleared!");
            }
        }
    </script>
</body>
</html>

